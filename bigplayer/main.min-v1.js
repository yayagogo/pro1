var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ui;!function(t){var e=function(){function t(t,e,n){void 0===n&&(n=500),this._curtime=0,this._callBack=t,this._thisObj=e,this._maxtime=n}return t.prototype.onClick=function(t){if(egret.getTimer()-this._curtime>this._maxtime){this._curtime=egret.getTimer();var e=this._callBack;e&&e.apply(this._thisObj,[t])}},t}();__reflect(e.prototype,"OnceListener");var n=function(n){function i(t){var i=n.call(this)||this;return i.msgKeys=[],i.watchTokenKeys=[],i.watchRoomKeys=[],i._onceListener=new e(i.onClick,i,500),t&&(i.skinName=t),i}return __extends(i,n),i.prototype.setOnClick1=function(t,n,i){void 0===i&&(i=500);var o=new e(n,this,i);"string"==typeof t&&(t=this.getChildByName(t)),t&&t.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onClick,o)},i.prototype.setOnClick=function(t,n){var i=this;void 0===n&&(n=500),t&&t.forEach(function(t){var o=500==n?i._onceListener:new e(i.onClick,i,n);"string"==typeof t&&(t=i.getChildByName(t)),t&&t.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onClick,o)})},i.prototype.setOnEvent=function(t,e,n,i){var o=this;t.forEach(function(t){var a=i||o;"string"==typeof t&&(t=a.getChildByName(t)),t&&t.addEventListener(e,n,o)})},i.prototype.rmvEvent=function(t,e,n,i){var o=this;t.forEach(function(t){var a=i||o;"string"==typeof t&&(t=a.getChildByName(t)),t&&t.removeEventListener(e,n,o)})},i.prototype.$onAddToStage=function(t,e){n.prototype.$onAddToStage.call(this,t,e),MessageBus.getInstance().register(this.msgKeys,this),this.onResume()},i.prototype.$onRemoveFromStage=function(){n.prototype.$onRemoveFromStage.call(this),MessageBus.getInstance().unregister(this),api.Web3Manager.getInstance().unwatchToken(this.watchTokenKeys),api.Web3Manager.getInstance().unwatchRoom(this.watchRoomKeys),this.onPause()},i.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.onUiLoaded()},i.prototype.toString=function(){return"UI-"+this.hashCode},i.prototype.onClick=function(t){},i.prototype.onReceive=function(t){},i.prototype.show=function(){},i.prototype.dismiss=function(){},i.prototype.onUiLoaded=function(){},i.prototype.onResume=function(){},i.prototype.onPause=function(){},i.prototype.showToast=function(t){UIMgr.showToast(t)},i.prototype.showLoading=function(t){void 0===t&&(t="请稍候..."),UIMgr.showLoading(t)},i.prototype.dissLoading=function(){UIMgr.dissLoading()},i.prototype.showLoginDialog=function(){null==i.loginDialog&&(i.loginDialog=new t.LoginDialog),i.loginDialog.show()},i.prototype.showPwdDialog=function(e,n){void 0===n&&(n="pwd"),null==i.pwdDialog&&(i.pwdDialog=new t.TokenPwdDialog),i.pwdDialog.currentState=n,i.pwdDialog.callback=e,i.pwdDialog.show()},i}(eui.Component);t.BaseUI=n,__reflect(n.prototype,"ui.BaseUI",["Receiver"])}(ui||(ui={}));var api;!function(t){t.path_abi_token="Token_json",t.path_abi_room="Room_json",t.path_abi_free="Free_json",t.path_bin_room="Room_bin",t.ETH_UNIT=1e18,t.BPN_UNIT=1e8,t.BPN_QUA=2,t.ETH_QUA=4,t.BPN_SYM="BPN",t.ETH_SYM="ETH";var e=function(){function t(t,e,n,i){"string"==typeof t?this.msg=t:(this.data=t,this.attr=e,null==i?this.msg=n:(this.attr2=n,this.msg=i))}return t.prototype.callback=function(t,e){if(Log.d(t+"=>"+e),null==t){var n=e.toString();this.data&&this.attr&&(null==this.attr2?this.data[this.attr]=n:(this.data[this.attr]=this.data[this.attr]||{},this.data[this.attr][this.attr2]=n)),this.msg&&MessageBus.getInstance().send(this.msg,n,0)}else this.msg&&MessageBus.getInstance().send(this.msg,t,-1)},Object.defineProperty(t.prototype,"ck",{get:function(){return this.callback.bind(this)},enumerable:!0,configurable:!0}),t}();t.CallBack=e,__reflect(e.prototype,"api.CallBack");var n=function(){function e(){this.initFlag=!1,this.keysMap=new utils.Dictionary,this.init(atCnf.url),this.initKey(atCnf.test_owner,atCnf.test_key)}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.init=function(t){this.initFlag||(this.initFlag=!0,this._web3=new Web3(new Web3.providers.HttpProvider(t)),this._eth=this.web3.eth)},e.prototype.initApi=function(){this.getRoomAPI(),this.getTokenApi(),this.getFreeAPI()},e.prototype.transfer=function(t,e,n,i){this._eth.sendTransaction({from:t,to:e,value:this.web3.toWei(n,i),gas:3e4},function(t,e){t?console.log(t):console.log(e)})},Object.defineProperty(e.prototype,"eth",{get:function(){return this._eth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"web3",{get:function(){return this._web3},enumerable:!0,configurable:!0}),e.prototype.balancof=function(t,e){return this._eth.getBalance(t,e.ck)},e.prototype.getContract=function(t){return this._eth.contract(t)},e.prototype.initKey=function(t,e){this.keysMap.setValue(t,e.substr(2))},e.prototype.getKey=function(t){return this.keysMap.getValue(t)},e.prototype._newAccount=function(t){var e=this.web3.personal.newAccount(t);return e},e.prototype.unlockAccount=function(e,n,i){void 0===i&&(i=5e3),this._eth.defaultAccount=e;var o=t.Web3Manager.getInstance().getKey(e);if(null==o){var a=UserManager.getInstance().getAccount();if(null==a.keyStore)return!1;var s=ethereumjs.Wallet.fromV3(a.keyStore,n);if(s){var r=s.getPrivateKeyString();return t.Web3Manager.getInstance().initKey(a.addr,r),!0}return!1}return!0},e.prototype.initTokenAPI=function(){return null==this.tokenApi&&(this.tokenApi=new a,this.tokenApi.init()),this.tokenApi.initOK},e.prototype.getTokenApi=function(){return this.initTokenAPI(),this.tokenApi},e.prototype.initFreeAPI=function(){return null==this.freeApi&&(this.freeApi=new o,this.freeApi.init()),this.tokenApi.initOK},e.prototype.getFreeAPI=function(){return this.initFreeAPI(),this.freeApi},e.prototype.initRoomAPI=function(){return null==this.roomApi&&(this.roomApi=new s,this.roomApi.init()),this.roomApi.initOK},e.prototype.getRoomAPI=function(t){return this.initRoomAPI(),t&&this.roomApi.initOK&&this.roomApi.changeAt(t),this.roomApi},e.prototype.unwatchToken=function(t){if(t&&t.length>0){var e=this.getTokenApi();t.forEach(function(t){e.unwatchEvent(t)})}},e.prototype.unwatchRoom=function(t){if(t&&t.length>0){var e=this.getRoomAPI();t.forEach(function(t){e.unwatchEvent(t)})}},e}();t.Web3Manager=n,__reflect(n.prototype,"api.Web3Manager");var i=function(){function e(t,e){this._initOK=!1,this.filterMaps=new utils.Dictionary,this.at=t,this.abiPath=e}return e.prototype.init=function(){if(!this._initOK){var t=RES.getRes(this.abiPath);this.abiLoaded(t)}},e.prototype.abiLoaded=function(t){this.Contract=n.getInstance().getContract(t),this.at&&"0x0"!=this.at&&(this.contract=this.Contract.at(this.at)),this._initOK=!0},e.prototype.watchEvent=function(e,n){t.Web3Manager.getInstance().web3.eth.getTransactionReceipt(n,function(t,i){if(!t)if(Log.d("watch->"+i),i&&i.logs&&i.logs.length>0)MessageBus.getInstance().send(e,i.transactionHash);else{var o=egret.setTimeout(this.watchEvent,this,2e4,e,n);this.filterMaps.setValue(n,o)}}.bind(this))},e.prototype.unwatchEvent=function(t){var e=this.filterMaps.getValue(t);e&&(egret.clearTimeout(e),this.filterMaps.remove(t),Log.d("stopWatching: "+t))},e.prototype.submit=function(e,i,o){var a=this,s=n.getInstance().web3;s.eth.defaultBlock="pending";var r=s.eth.getTransactionCount(e);s.eth.defaultBlock="latest",Log.d("nonce = "+r);s.eth.estimateGas({to:this.at,data:i,nonce:r},function(n,c){if(null!=n)return Log.e(n),void o.callback(n,null);var u={nonce:r,from:e,to:a.at,data:i,value:"0x00",gas:c,gasPrice:s.toHex(s.eth.gasPrice),chainId:4},h=t.Web3Manager.getInstance().getKey(e);if(h){var p=new ethereumjs.Buffer.Buffer(h,"hex"),l=new ethereumjs.Tx(u);l.sign(p);var g=l.serialize();s.eth.sendRawTransaction("0x"+g.toString("hex"),o.ck)}else o.callback(new Error("invalid key!"),null)})},e.prototype.changeAt=function(t){return this._initOK?(t!=this.at&&(this.at=t,this.contract=this.Contract.at(t)),!0):!1},Object.defineProperty(e.prototype,"initOK",{get:function(){return this._initOK},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"address",{get:function(){return this.at},enumerable:!0,configurable:!0}),e}();t.Contract=i,__reflect(i.prototype,"api.Contract");var o=function(e){function n(){return e.call(this,atCnf.freeAt,t.path_abi_free)||this}return __extends(n,e),n.prototype.freeTake=function(t,e){var n=this.contract.freeTake.getData(t);return this.submit(atCnf.test_owner,n,e),!0},n}(i);t.FreeAPI=o,__reflect(o.prototype,"api.FreeAPI");var a=function(e){function n(){return e.call(this,atCnf.tokenAt,t.path_abi_token)||this}return __extends(n,e),n.prototype.totalSupply=function(){return this.contract.totalSupply()},n.prototype.balanceOf=function(t,e){return this.contract.balanceOf(t,e.ck)},n.prototype.transfer=function(t,e){return this.contract.transfer(t,e,function(t,e){null!=t?Log.e(t):Log.l(e)})},n.prototype.transferFrom=function(t,e,n){return this.contract.transferFrom(t,e,n,function(t,e){null!=t?Log.e(t):Log.l(e)})},n.prototype.approve=function(t,e,n,i){var o=this.contract.approve.getData(e,n);return this.submit(t,o,i),!0},n.prototype.allowance=function(t,e,n){return this.contract.allowance(t,e,n.ck)},n}(i);t.TokenAPI=a,__reflect(a.prototype,"api.TokenAPI");var s=function(e){function n(){var n=e.call(this,null,t.path_abi_room)||this;return n.jsonId=1,n}return __extends(n,e),n.prototype.Event_Bet=function(t){},n.prototype.Event_Payout=function(t){},n.prototype.getEventLogs=function(e,n,i){var o=this.contract[e]({player:n},{fromBlock:0,toBlock:"latest"}),a={params:[o.options],method:"eth_getLogs",id:this.jsonId++,jsonrpc:"2.0"};t.Web3Manager.getInstance().web3.currentProvider.sendAsync(a,function(t,e){if(null==t&&e){Log.l(e);var n=e.result.length;if(n>0){for(var a=[],s=n-1;s>=0;s--){var r=o.formatter(e.result[s]);a.push(r)}i.loadList(a)}}})},n.prototype.bet=function(t,e,n,i){var o=this.contract.bet.getData(e,n);return this.submit(t,o,i),!0},n.prototype.getBet=function(t,e){return this.contract.getBet(t,e)},n.prototype.getPool=function(t){return this.contract.getPool(t)},n.prototype.getPNum=function(t){return this.contract.getPNum(t.ck)},n.prototype.betPv=function(t,e){return this.contract.betPv(t,e.ck)},n.prototype.state=function(t){return this.contract.state(t.ck)},n}(i);t.RoomAPI=s,__reflect(s.prototype,"api.RoomAPI")}(api||(api={}));var ui;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.show=function(){UIMgr.showPanel(this),UIMgr.showMask()},e.prototype.dismiss=function(){UIMgr.dissPanel(),UIMgr.dissMask()},e}(t.BaseUI);t.BasePanel=e,__reflect(e.prototype,"ui.BasePanel")}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.show=function(){UIMgr.showScene(this)},e}(t.BaseUI);t.BaseScene=e,__reflect(e.prototype,"ui.BaseScene")}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.msgKeys.push(MessageKeys.MSG_LOGIN,MessageKeys.MSG_BALANCE,MessageKeys.MSG_GAS_BALANCE,MessageKeys.MSG_NEW_ADDRESS,MessageKeys.MSG_FILL_GAS),e}return __extends(e,t),e.prototype.onUiLoaded=function(){this.setOnClick1(this.btn_login,this.showLoginDialog),this.setOnClick1(this.btn_new_account,this.newAccount),this.setOnClick1(this.btn_gas,this.fillGas),this.listData=new eui.ArrayCollection,this.mine_list.dataProvider=this.listData},e.prototype.fillGas=function(){this.showLoading(),UserManager.getInstance().test_fee(new api.CallBack(MessageKeys.MSG_FILL_GAS))},e.prototype.newAccount=function(){var t=this;this.showPwdDialog(function(e){t.showLoading(),UserManager.getInstance().newEa(e)})},e.prototype.onResume=function(){},e.prototype.onPause=function(){},e.prototype.doResume=function(){var t=UserManager.getInstance().isLogin();if(this.currentState=t?"user":"visitor",t){var e=UserManager.getInstance().getAccount();this.tv_email.text=e.email,UserManager.getInstance().havaEa()?(this.tv_address.text=e.addr,e.amount&&(this.tv_balance.text=FormatUtil.formatToken(e.amount)),this.btn_new_account.visible=!1,UserManager.getInstance().queryBalance(),UserManager.getInstance().queryGasBalance(),this.getBetLog()):this.btn_new_account.visible=!0}},e.prototype.getBetLog=function(){var t=UserManager.getInstance().getAccount(),e=this.listData;if(e.removeAll(),t&&t.rooms)for(var i in t.rooms){var o=api.Web3Manager.getInstance().getRoomAPI(i),a=new n(1,i,null,e);o.getEventLogs("Payout",t.addr,a);var s=new n(0,i,null,e);o.getEventLogs("Bet",t.addr,s)}},e.prototype.onReceive=function(t){switch(t.what){case MessageKeys.MSG_LOGIN:this.dissLoading(),0==t.arg1&&this.doResume();break;case MessageKeys.MSG_FILL_GAS:this.dissLoading(),UserManager.getInstance().queryGasBalance();break;case MessageKeys.MSG_GAS_BALANCE:this.dissLoading();var e=t.obj;this.tv_ethBalance.text=FormatUtil.formatToken(parseInt(e),api.ETH_UNIT,api.ETH_SYM,api.ETH_QUA);break;case MessageKeys.MSG_BALANCE:var n=UserManager.getInstance().getAccount();n.amount&&(this.tv_balance.text=FormatUtil.formatToken(n.amount));break;case MessageKeys.MSG_NEW_ADDRESS:this.doResume(),this.dissLoading()}},e}(t.BaseUI);t.MineUI=e,__reflect(e.prototype,"ui.MineUI");var n=function(){function t(t,e,n,i){this.type=t,this.addr=e,this.event=n,this.list=i}return t.prototype.load=function(t){this.event.get(function(e,n){null==e&&this.loadList(t,n)}.bind(this))},t.prototype.loadList=function(t){var e=RaceManager.getInstance().getRaceName(this.addr),n=0==this.type?"投注":"派彩",i=api.Web3Manager.getInstance().eth,o=this.list,a=this.type;t.forEach(function(t){var s=t.args,r={name:e,play:s.play,bet:n+"\n"+FormatUtil.formatToken(s.amt.toNumber())};0==a?o.addItem(r):o.addItemAt(r,0),i.getBlock(t.blockNumber,function(t,e){null==t&&(this.time=new Date(1e3*e.timestamp).format("yyyy-MM-dd\nhh:mm:ss"))}.bind(r))})},t}();t.EventLog=n,__reflect(n.prototype,"ui.EventLog")}(ui||(ui={}));var UserManager=function(){function t(){this.user={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.prototype.getAccount=function(){return this.user},t.prototype.isLogin=function(){return this.user&&null!=this.user.uid},t.prototype.login=function(t,e){firebase.auth().signInWithEmailAndPassword(t,e).then(this.onAuthSuccess,this.onAuthError)},t.prototype.onAuthSuccess=function(e){var n=t.getInstance().user,i=e.user;n.uid=i.uid,n.emailVerified=i.emailVerified,n.email=i.email,n.emailVerified?firebase.database().ref("/users/"+n.uid).once("value").then(function(e){var n=e.val();if(n){var i=t.getInstance().user;i.addr=n.addr,i.rooms=n.rooms||{},i.keyStore=n.keyStore,t.getInstance().queryBalance()}MessageBus.getInstance().send(MessageKeys.MSG_LOGIN,0)}):(i.sendEmailVerification(),MessageBus.getInstance().send(MessageKeys.MSG_LOGIN,-2))},t.prototype.onAuthError=function(t){Log.d(t.toString()),MessageBus.getInstance().send(MessageKeys.MSG_LOGIN,-1)},t.prototype.register=function(t,e){firebase.auth().createUserWithEmailAndPassword(t,e).then(this.onCreateSuccess,this.onCreateError)},t.prototype.onCreateSuccess=function(t){Log.d(t.toString());var e=t.user;e&&e.sendEmailVerification(),MessageBus.getInstance().send(MessageKeys.MSG_REGISTER,0)},t.prototype.onCreateError=function(t){Log.d(t.toString()),MessageBus.getInstance().send(MessageKeys.MSG_REGISTER,-1)},t.prototype.queryBalance=function(){if(this.havaEa()){var t=api.Web3Manager.getInstance().getTokenApi();t.balanceOf(this.user.addr,new api.CallBack(this.user,"amount",MessageKeys.MSG_BALANCE))}},t.prototype.queryGasBalance=function(){this.havaEa()&&api.Web3Manager.getInstance().balancof(this.user.addr,new api.CallBack(MessageKeys.MSG_GAS_BALANCE))},t.prototype.getBalance=function(){return this.havaEa()?this.user.amount>0?this.user.amount:void this.queryBalance():-1},t.prototype.nextRankList=function(t){HttpUtils.request(atCnf.rankUrl+"&p="+t,{onLoadFinish:function(e){var n=e.target.response,i=new DOMParser,o=i.parseFromString(n,"text/html"),a=o.getElementById("maintable"),s=a.children.item(0).children.item(0);if(s){for(var r=s.children.length,c=void 0,u=void 0,h=[],p=1;r>p;p++)if(c=s.children.item(p),u=c.cells,u.length>=3){var l={};if(l.addr=u.item(1).textContent,0==l.addr.length)break;if(atCnf.roomer.toLowerCase()==l.addr||atCnf.tokener.toLowerCase()==l.addr)continue;l.amt=u.item(2).textContent+"\n"+api.BPN_SYM,h.push(l)}var g={};g.page=t,g.list=h,MessageBus.getInstance().send(MessageKeys.MSG_RANK_LIST,g,0)}},onLoadError:function(t){Log.e(t),MessageBus.getInstance().send(MessageKeys.MSG_RANK_LIST,-1)}},!0)},t.prototype.havaEa=function(){return this.user&&this.user.addr&&"0x0"!=this.user.addr},t.prototype.newEa=function(t){var e=ethereumjs.Wallet.generate(!0);this.submitEa(t,e)},t.prototype.testMyKey=function(){var t=atCnf.test_owner,e=atCnf.test_key;HttpUtils.request("./configs/"+t,{onLoadFinish:function(t){var n=JSON.parse(t.target.response),i=ethereumjs.Wallet.fromV3(n,e);Log.l(i.getPrivateKeyString())},onLoadError:function(t){}})},t.prototype.submitEa=function(t,e){var n=this,i=this.user,o=e.getAddressString();Log.d("newAddr="+o);var a=e.toV3(t),s={email:i.email,addr:o,keyStore:a};firebase.database().ref("users/"+i.uid).set(s,function(t){if(null==t){Log.l("newEa="+o);var i=n.user;i.addr=o,i.rooms={},api.Web3Manager.getInstance().initKey(o,e.getPrivateKeyString()),n.test_fee(new api.CallBack(MessageKeys.MSG_NEW_ADDRESS))}})},t.prototype.addRoom=function(e,n){var i=this.user;if(null==i.rooms&&(i.rooms={}),null==i.rooms[e]){var o={type:n};firebase.database().ref("users/"+i.uid+"/rooms/"+e).set(o,function(i){null==i&&(Log.d("save rook ok"),t.getInstance().user.rooms[e]=n)})}},t.prototype.test_fee=function(t){var e=api.Web3Manager.getInstance().getFreeAPI();e.freeTake(this.user.addr,t)},t}();__reflect(UserManager.prototype,"UserManager");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?i(o):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.init(),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&(api.Web3Manager.getInstance().initApi(),UIMgr.init2(this),this.startCreateScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName},e.prototype.startCreateScene=function(){RaceManager.getInstance().loadInit(function(t){if(0==t){var e=document.getElementsByClassName("loading-container")[0];e.parentElement.removeChild(e);var n=new ui.PlazaUI;n.show()}})},e.prototype.init=function(){Log.DEBUG=!0,Log.LEVEL=0,egret.TextField.default_fontFamily="Microsoft YaHei",api.Web3Manager.getInstance();var t={apiKey:"AIzaSyBDWLL31Cwh--eDeUZWJJ_OhH2WeqW4R7U",authDomain:"sthaha-6e43a.firebaseapp.com",databaseURL:"https://sthaha-6e43a.firebaseio.com",projectId:"sthaha-6e43a",storageBucket:"sthaha-6e43a.appspot.com",messagingSenderId:"321749934712"};firebase.initializeApp(t),this.initDate(),UIMgr.init(this)},e.prototype.initDate=function(){Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t}},e}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function o(t){e.call(i,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var RaceHistory=function(){function t(){}return t}();__reflect(RaceHistory.prototype,"RaceHistory");var RaceManager=function(){function t(){}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.prototype.getTeamName=function(t){return this.teamInfo[t].name_zh},t.prototype.getRaceName=function(t){for(var e,n=this.raceInfo.length,i=this.raceInfo,o=0;n>o;o++)if(i[o].addr==t){e=i[o];break}return e?this.getTeamName(e.teams[0])+"\n"+this.getTeamName(e.teams[1]):""},t.prototype.getRaceList=function(){return this.raceInfo},t.prototype.loadInit=function(e){HttpUtils.request(t.RACE_URL,{onLoadFinish:function(n){var i=JSON.parse(n.target.response);t.getInstance().raceInfo=i.race,t.getInstance().teamInfo=i.team,e(0)},onLoadError:function(t){e(-1)}})},t.prototype.loadHistory=function(e){HttpUtils.request(t.HISTORY_URL+e,{onLoadFinish:function(t){var n=JSON.parse(t.target.response),i=new RaceHistory;i.team=e,i.records=n,MessageBus.getInstance().send(MessageKeys.MSG_HISTORY,i)},onLoadError:function(t){}})},t.RACE_URL="./configs/data/race_list_r.json",t.HISTORY_URL="./configs/data/race_history",t}();__reflect(RaceManager.prototype,"RaceManager");var ui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName=skin.LoadingSkin,e}return __extends(e,t),e.prototype.show=function(t){this.visible=!0,egret.Tween.get(this.ic_loading,{loop:!0}).to({rotation:3600},1e4)},e.prototype.diss=function(){egret.Tween.removeTweens(this.ic_loading),this.visible=!1},e}(eui.Component);t.Loading=e,__reflect(e.prototype,"ui.Loading")}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName=skin.LoginDialogSkin,e.msgKeys.push(MessageKeys.MSG_LOGIN,MessageKeys.MSG_REGISTER),e}return __extends(e,t),e.prototype.onUiLoaded=function(){this.setOnClick1(this.btn_ok,this.doOK)},e.prototype.doOK=function(){var t=this.et_email.text,e=this.et_pwd.text;this.showLoading(),this.rb_login.selected?UserManager.getInstance().login(t,e):this.rb_register.selected&&UserManager.getInstance().register(t,e)},e.prototype.onResume=function(){},e.prototype.onPause=function(){},e.prototype.onReceive=function(t){var e=t.arg1;switch(this.dissLoading(),t.what){case MessageKeys.MSG_LOGIN:case MessageKeys.MSG_REGISTER:0!=e?-2==e?this.showToast("邮箱未验证，请邮箱中进行验证操作"):this.showToast("操作失败,请检查网络"):this.dismiss()}},e}(t.BasePanel);t.LoginDialog=e,__reflect(e.prototype,"ui.LoginDialog")}(ui||(ui={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var ui;!function(t){var e=function(t){function e(){var e=t.call(this,skin.PlazaUISkin)||this;return e.msgKeys.push(MessageKeys.MSG_RANK_MINE),e}return __extends(e,t),e.prototype.onUiLoaded=function(){this.rb_race.group.addEventListener(egret.Event.CHANGE,this.onTabChanged,this)},e.prototype.onResume=function(){},e.prototype.onPause=function(){this.rb_race.group.removeEventListener(egret.Event.CHANGE,this.onTabChanged,this)},e.prototype.onTabChanged=function(t){var e=t.target,n=e.selectedValue;switch(n){case"0":this.viewStack.selectedIndex=0,this.tv_title.text="世界杯赛程",this.tv_title_l.visible=!1,this.tv_title_r.visible=!1;break;case"1":this.viewStack.selectedIndex=1,this.tv_title.text="大师排行";var i=UserManager.getInstance().getBalance();this.rankUI.doResume(),i>0?(this.tv_title_l.visible=!0,this.tv_title_r.visible=!1,this.tv_title_l.text="余额："+FormatUtil.formatToken(i)):(this.tv_title_l.visible=!1,this.tv_title_r.visible=!1);break;case"2":this.viewStack.selectedIndex=2,this.tv_title.text="个人中心",this.tv_title_l.visible=!0,this.tv_title_r.visible=!1,this.mineUI.doResume(),this.tv_title_l.text="Rinkeyby\ntest network"}},e.prototype.onClick=function(t){},e.prototype.onReceive=function(t){switch(t.what){case MessageKeys.MSG_RANK_MINE:0==t.arg1}},e}(t.BaseScene);t.PlazaUI=e,__reflect(e.prototype,"ui.PlazaUI")}(ui||(ui={}));var ui;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.isScrolling=!1,t.msgKeys.push(MessageKeys.MSG_PEOPLE),t}return __extends(i,e),i.prototype.onUiLoaded=function(){this.race_list.itemRenderer=n,this.race_list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemClick,this),this.race_scroller.addEventListener(eui.UIEvent.CHANGE_END,this.onScrollEnd,this),this.race_scroller.addEventListener(eui.UIEvent.CHANGE_START,this.onScrollStart,this)},i.prototype.onResume=function(){var t=new eui.ArrayCollection,e=RaceManager.getInstance().getRaceList();e.forEach(function(e,n){t.addItem(e)}),this.race_list.dataProvider=t,egret.setTimeout(this.onScrollEnd,this,1e3),egret.setTimeout(this.restoreIndex,this,100)},i.prototype.onPause=function(){this.race_scroller.removeEventListener(eui.UIEvent.CHANGE_END,this.onScrollEnd,this),this.race_scroller.removeEventListener(eui.UIEvent.CHANGE_START,this.onScrollStart,this)},i.prototype.onScrollStart=function(){this.isScrolling=!0},i.prototype.onScrollEnd=function(){this.isScrolling=!1;var t=api.Web3Manager.getInstance().getRoomAPI(),e=this.race_list;i.lastPos=e.scrollV;for(var n,o=e.numChildren,a=0;o>a;a++){n=e.getChildAt(a);var s=n.data,r=s.addr;r&&"0x0"!=r&&null==s.pnum&&(t.changeAt(r),t.getPNum(new api.CallBack(s,"pnum",MessageKeys.MSG_PEOPLE)))}},i.prototype.restoreIndex=function(){this.race_list.scrollV=i.lastPos},i.prototype.onItemClick=function(){var e=this.race_list.selectedItem;if(e){var n=new t.RoomUI(e);n.show()}},i.prototype.onReceive=function(t){switch(t.what){case MessageKeys.MSG_PEOPLE:if(this.isScrolling)return;for(var e=this.race_list,n=e.numChildren,i=0;n>i;i++){var o=e.getChildAt(i);o.updateNum()}}},i.prototype.onClick=function(t){t.target.name},i.lastPos=0,i}(t.BaseUI);t.RaceListUI=e,__reflect(e.prototype,"ui.RaceListUI");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName=skin.ItemRaceSkin,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.name=t.addr,"room"!=this.currentState&&(this.currentState=t.head?"head":"none",this.height=t.head?301:241),this.ic_team1.source="flag_"+t.teams[0]+"_png",this.ic_team2.source="flag_"+t.teams[1]+"_png",this.tv_team1.text=RaceManager.getInstance().getTeamName(t.teams[0]),this.tv_team2.text=RaceManager.getInstance().getTeamName(t.teams[1]),this.tv_time.text=t.time,this.tv_date.text=t.date_zh,this.updateNum()},e.prototype.updateNum=function(){var t=this.data;t.pnum?(this.tv_people.text=t.pnum,this.ic_people.visible=!0):(this.tv_people.text="",this.ic_people.visible=!1)},e}(eui.ItemRenderer);t.ItemRaceRender=n,__reflect(n.prototype,"ui.ItemRaceRender")}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.page=0,e.pageEnable=!0,e.msgKeys.push(MessageKeys.MSG_RANK_LIST),e}return __extends(e,t),e.prototype.onUiLoaded=function(){this.rank_scroller.addEventListener(eui.UIEvent.CHANGE_END,this.scrollEnd,this),this.rank_list.itemRenderer=n},e.prototype.onResume=function(){},e.prototype.onPause=function(){},e.prototype.scrollEnd=function(){var t=this.rank_list.contentHeight-this.rank_scroller.height;this.pageEnable&&this.rank_list.scrollV>=t&&(this.page++,this.loadList())},e.prototype.doResume=function(){0==this.page&&(this.page=1,this.loadList())},e.prototype.loadList=function(){this.showLoading(),UserManager.getInstance().nextRankList(this.page)},e.prototype.onReceive=function(t){switch(t.what){case MessageKeys.MSG_RANK_LIST:if(this.dissLoading(),0==t.arg1){var e=t.obj,n=this.rank_list.dataProvider;null==n?(n=new eui.ArrayCollection(e.list),this.rank_list.dataProvider=n):(1==e.page?(n.removeAll(),n.source=e.list,this.pageEnable=!0):e.list.forEach(function(t){n.addItem(t)}),e.list.length<50&&(this.pageEnable=!1))}}},e}(t.BaseUI);t.RankUI=e,__reflect(e.prototype,"ui.RankUI");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName=skin.ItemRankSkin,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=this.itemIndex+1;t.rank=""+e,this.tv_index.text=""+t.rank,this.tv_addr.text=this.maskAddr(t.addr),this.tv_amt.text=t.amt,this.tv_reward.text=this.getReward(e)+"\n"+api.BPN_SYM},e.prototype.getReward=function(t){return 1==t?"100,000":2==t?"50,000":3==t?"30,000":10>=t?"10,000":50>=t?"5,000":100>=t?"1,000":1e3>=t?"500":"-"},e.prototype.maskAddr=function(t){var e=t.length;return t.substring(0,e/2-8)+"......"+t.substring(e/2+8,e)},e}(eui.ItemRenderer);__reflect(n.prototype,"ItemRankRender")}(ui||(ui={}));var ui;!function(t){var e=function(e){function n(t){var n=e.call(this,skin.RoomUISkin)||this;return n.raceInfo=t,n.msgKeys.push(MessageKeys.MSG_LOGIN,MessageKeys.MSG_BALANCE,MessageKeys.MSG_NEW_ADDRESS,MessageKeys.MSG_ROOM_PV,MessageKeys.MSG_ROOM_STATE,MessageKeys.MSG_BET,MessageKeys.MSG_APPOVE_OK,MessageKeys.MSG_UPDATE_ALLOWANCE,MessageKeys.EVENT_Approval,MessageKeys.EVENT_Bet,MessageKeys.MSG_HISTORY),n}return __extends(n,e),n.prototype.onUiLoaded=function(){this.setOnClick(["btn_back","btn_help","btn_bet"]),this.setOnClick1(this.btn_login,this.showLoginDialog),this.setOnClick1(this.btn_appove,this.onAppove),this.setOnEvent([this.rb_play_0,this.rb_play_1,this.rb_play_2],egret.Event.CHANGE,this.onSelPlay),this.setOnEvent([this.rb_record_0,this.rb_record_1,this.rb_record_2],egret.Event.CHANGE,this.onSelRecord),this.et_play.textDisplay.addEventListener(egret.Event.CHANGE,this.onAmtChange,this)},n.prototype.onResume=function(){var t=this.raceInfo;this.race_info.data=t;var e=RaceManager.getInstance().getTeamName(t.teams[0]),n=RaceManager.getInstance().getTeamName(t.teams[1]);
if(this.rb_play_0.label=e,this.rb_play_2.label=n,this.rb_record_0.label=e+"战绩",this.rb_record_2.label=n+"战绩",this.updateUserRoom(!1),this.checkStatus(),this.loadRecord("rb_record_0"),this.play=-1,null==t.pv||null==t.pv[-1]||null==t.pv[0]||null==t.pv[1]){var i=api.Web3Manager.getInstance().getRoomAPI(t.addr);i.betPv(-1,new api.CallBack(t,"pv","-1",MessageKeys.MSG_ROOM_PV)),i.betPv(0,new api.CallBack(t,"pv","0",MessageKeys.MSG_ROOM_PV)),i.betPv(1,new api.CallBack(t,"pv","1",MessageKeys.MSG_ROOM_PV))}else this.onPvBack()},n.prototype.onPause=function(){this.rmvEvent([this.rb_play_0,this.rb_play_1,this.rb_play_2],egret.Event.CHANGE,this.onSelPlay),this.rmvEvent([this.rb_record_0,this.rb_record_1,this.rb_record_2],egret.Event.CHANGE,this.onSelRecord),this.et_play.textDisplay.removeEventListener(egret.Event.CHANGE,this.onAmtChange,this)},n.prototype.checkStatus=function(){var t=this.raceInfo,e=api.Web3Manager.getInstance().getRoomAPI(t.addr);e.state(new api.CallBack(MessageKeys.MSG_ROOM_STATE))},n.prototype.onState=function(t){if(0==t.arg1){var e=t.obj;"1"!=e&&(this.btn_bet.enabled=!1,this.tv_statu.text="停止竞猜")}},n.prototype.updateUserRoom=function(t){UserManager.getInstance().havaEa()&&(this.updateBalance(),this.currentState="user",UserManager.getInstance().queryBalance()),this.appoveUpdate(t)},n.prototype.updateBalance=function(){var t=UserManager.getInstance().getAccount();t&&t.amount>=0&&(this.tv_amount.text=FormatUtil.formatToken(t.amount))},n.prototype.onPvBack=function(){var t,e=this.raceInfo;e.pv[-1]&&(t=this.rb_play_0.getChildByName("tv_pv"),t.text=""+e.pv[-1]/100),e.pv[0]&&(t=this.rb_play_1.getChildByName("tv_pv"),t.text=""+e.pv[0]/100),e.pv[1]&&(t=this.rb_play_2.getChildByName("tv_pv"),t.text=""+e.pv[1]/100)},n.prototype.onAmtChange=function(){var t=this.raceInfo,e=t.pv[this.play],n=Number(this.et_play.text).valueOf()*e/100;this.tv_pre_win.text=FormatUtil.formatDouble(n)},n.prototype.onAppove=function(){var t=this;this.showPwdDialog(function(e,n){var i=t.raceInfo,o=api.Web3Manager.getInstance(),a=o.getTokenApi(),s=UserManager.getInstance().getAccount();t.showLoading(),o.unlockAccount(s.addr,e)?a.approve(s.addr,i.addr,n*api.BPN_UNIT,new api.CallBack(MessageKeys.MSG_APPOVE_OK)):t.showToast("钱包密码不正确")},"pwd_num")},n.prototype.appoveUpdate=function(t){var e=this;if(UserManager.getInstance().havaEa()){var n=this.raceInfo,i=api.Web3Manager.getInstance(),o=i.getTokenApi(),a=UserManager.getInstance().getAccount();o.allowance(a.addr,n.addr,new api.CallBack(MessageKeys.MSG_UPDATE_ALLOWANCE))}else t&&this.showPwdDialog(function(t){e.showLoading(),UserManager.getInstance().newEa(t)})},n.prototype.updateAllowance=function(t,e){0===t&&(this.allowAmt=e,this.btn_appove.label=FormatUtil.formatToken(e))},n.prototype.onSelPlay=function(t){switch(Log.l(t.target.name),t.target.name){case"rb_play_0":this.play=-1;break;case"rb_play_1":this.play=0;break;case"rb_play_2":this.play=1}this.onAmtChange()},n.prototype.onSelRecord=function(t){Log.l(t.target.name),this.loadRecord(t.target.name)},n.prototype.loadRecord=function(t){var e=this.raceInfo.teams,n="_";switch(t){case"rb_record_0":n+=e[0];break;case"rb_record_1":n+=e[0]+"_"+e[1];break;case"rb_record_2":n+=e[1]}n+=".json",this.team=n,RaceManager.getInstance().loadHistory(n)},n.prototype.onReceive=function(t){var e=t.arg1;switch(t.what){case MessageKeys.MSG_LOGIN:this.dissLoading(),0===e&&this.updateUserRoom(!0);break;case MessageKeys.MSG_NEW_ADDRESS:break;case MessageKeys.MSG_BALANCE:0===e&&this.updateBalance();break;case MessageKeys.MSG_ROOM_PV:this.onPvBack();break;case MessageKeys.MSG_APPOVE_OK:if(this.dissLoading(),0===e){this.appoveUpdate(!1);var n=api.Web3Manager.getInstance().getTokenApi(),i=t.obj;this.watchTokenKeys.push(i),n.watchEvent("Approval",i)}else this.showToast(t.obj.toString());break;case MessageKeys.MSG_UPDATE_ALLOWANCE:this.updateAllowance(t.arg1,t.obj);break;case MessageKeys.MSG_ROOM_STATE:this.onState(t);break;case MessageKeys.MSG_BET:this.onBet(t);break;case MessageKeys.EVENT_Approval:this.appoveUpdate(!1);break;case MessageKeys.EVENT_Bet:this.appoveUpdate(!1),UserManager.getInstance().queryBalance();break;case MessageKeys.MSG_HISTORY:var o=t.obj;if(this.team==o.team){var a=new eui.ArrayCollection(o.records);this.room_list.dataProvider=a}}},n.prototype.onBet=function(t){if(this.dissLoading(),0==t.arg1){this.showToast("竞猜成功");var e=t.obj;this.watchRoomKeys.push(e);var n=api.Web3Manager.getInstance().getRoomAPI();n.watchEvent("Bet",e),UserManager.getInstance().addRoom(n.address,1)}else this.showToast(t.obj.toString())},n.prototype.doBet=function(t,e){var n=this.raceInfo,i=UserManager.getInstance().getAccount(),o=api.Web3Manager.getInstance(),a=o.getRoomAPI(n.addr);this.showLoading(),o.unlockAccount(i.addr,t)&&a.bet(i.addr,this.play,e,new api.CallBack(MessageKeys.MSG_BET))},n.prototype.onClick=function(e){var n=this;switch(e.target.name){case"btn_back":var i=new t.PlazaUI;i.show();break;case"btn_help":break;case"btn_bet":if(!UserManager.getInstance().isLogin())return void this.showToast("您还未登录！");if(!UserManager.getInstance().havaEa())return void this.showToast("您还未绑定合约账户！");var o=Math.floor(Number(this.et_play.text).valueOf()*api.BPN_UNIT);if(o>this.allowAmt)return this.showToast("授信额度不足"),void this.onAppove();o>0?this.showPwdDialog(function(t){n.doBet(t,o)}):this.showToast("请输入额度")}},n}(t.BaseScene);t.RoomUI=e,__reflect(e.prototype,"ui.RoomUI")}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName=skin.ToastSkin,e}return __extends(e,t),e.prototype.show=function(t,e){this.tv_toast.text=t,this.visible=!0,this.timeId=egret.setTimeout(this.diss,this,e)},e.prototype.diss=function(){this.timeId>0&&(egret.clearTimeout(this.timeId),this.timeId=-1),this.visible=!1},e}(eui.Component);t.Toast=e,__reflect(e.prototype,"ui.Toast")}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName=skin.PwdDialogSkin,e}return __extends(e,t),e.prototype.onUiLoaded=function(){this.setOnClick1(this.btn_ok,this.onOK,1e3)},e.prototype.onResume=function(){},e.prototype.onPause=function(){},e.prototype.onOK=function(){var t=this.et_input.text;if(t&&t.length>0){var e=0;if("pwd_num"==this.currentState&&(e=Number(this.et_input_val.text).valueOf(),5e3>e))return void UIMgr.showToast("最低授信额度为5000");this.callback&&this.callback(t,e)}this.dismiss()},e}(t.BasePanel);t.TokenPwdDialog=e,__reflect(e.prototype,"ui.TokenPwdDialog")}(ui||(ui={}));var UIMgr=function(){function t(){}return t.init=function(e){var n=t.sceneLayer=new egret.DisplayObjectContainer;n.width=n.height=0,e.addChild(n);var i=t.maskLayer=new eui.Rect;i.fillColor=0,i.top=i.bottom=i.left=i.right=0,i.alpha=.3,i.touchEnabled=!0,i.visible=!1,i.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onTouchMask,t),e.addChild(i),n=t.panelLayer=new egret.DisplayObjectContainer,n.width=n.height=0,e.addChild(n)},t.onTouchMask=function(){t.dissMask(),t.dissPanel()},t.init2=function(e){var n=t.loading=new ui.Loading;n.visible=!1,n.verticalCenter=0,n.horizontalCenter=0,e.addChild(t.loading);var i=t.toast=new ui.Toast;i.visible=!1,i.verticalCenter=0,i.horizontalCenter=0,e.addChild(t.toast)},t.showScene=function(e){t.sceneLayer.removeChildren(),t.sceneLayer.addChild(e)},t.showPanel=function(e){t.panelLayer.removeChildren(),e.x=(t.panelLayer.stage.stageWidth-e.width)/2,e.y=(t.panelLayer.stage.stageHeight-e.height)/2,t.panelLayer.addChild(e),t.panelLayer.visible=!0},t.dissPanel=function(){t.panelLayer.removeChildren(),t.panelLayer.visible=!1},t.showMask=function(){t.maskLayer.visible=!0},t.dissMask=function(){t.maskLayer.visible=!1},t.showToast=function(e,n){void 0===n&&(n=3e3),t.toast.show(e,n)},t.showLoading=function(e){t.loading.show(e)},t.dissLoading=function(){t.loading.diss()},t}();__reflect(UIMgr.prototype,"UIMgr");var FormatUtil=function(){function t(){}return t.formatToken=function(t,e,n,i){void 0===e&&(e=api.BPN_UNIT),void 0===n&&(n=api.BPN_SYM),void 0===i&&(i=api.BPN_QUA);var o=Math.pow(10,i);return Math.floor(t/e*o)/o+n},t.formatDouble=function(t,e){void 0===e&&(e=api.BPN_QUA);var n=Math.pow(10,e);return""+Math.floor(t*n)/n},t}();__reflect(FormatUtil.prototype,"FormatUtil");var HttpUtils=function(){function t(){}return t.request=function(t,e,n){var i=new egret.HttpRequest;n&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),i.addEventListener(egret.Event.COMPLETE,e.onLoadFinish,e),i.addEventListener(egret.IOErrorEvent.IO_ERROR,e.onLoadError,e),i.open(t,n?egret.HttpMethod.POST:egret.HttpMethod.GET),i.send()},t}();__reflect(HttpUtils.prototype,"HttpUtils");var Log=function(){function t(){egret.Logger.logLevel=egret.Logger.INFO}return t.f=function(e){t.print(e,6)},t.e=function(e){t.print(e,5)},t.w=function(e){t.print(e,4)},t.i=function(e){t.print(e,3)},t.l=function(e){t.print(e,2)},t.d=function(e){t.print(e,1)},t.print=function(e,n){if(t.DEBUG&&t.LEVEL<n)if(t.ON_PLANE)switch(n){case 6:egret.error(e+"");break;case 5:egret.warn(e+"");break;case 4:egret.log(e+"");break;default:egret.log(e+"")}else switch(n){case 6:console.error(e+"");break;case 5:console.error(e+"");break;case 4:console.warn(e+"");break;case 3:console.info(e+"");break;case 2:console.log(e+"");break;case 1:console.debug(e+"")}},t.DEBUG=!1,t.ON_PLANE=!1,t.LEVEL=6,t.TEST=!1,t}();__reflect(Log.prototype,"Log");var MessageBus=function(){function t(){this.registraions=new utils.Dictionary}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.prototype.register=function(t,e){if(t&&t.length>0){var n=this.registraions,i=n.getValue(e);null==i&&(i=new utils.Set,n.setValue(e,i)),t.forEach(function(t){i.add(t)})}},t.prototype.unregister=function(t){this.registraions.remove(t)},t.prototype.send=function(t,e,n,i){var o=new MMessage;o.what=t,null!=e&&("number"==typeof e?o.arg1=e:(o.obj=e,o.arg1=n,o.arg2=i)),this.registraions.forEach(function(e,n){n.contains(t)&&e.onReceive(o)})},t}();__reflect(MessageBus.prototype,"MessageBus");var MMessage=function(){function t(){}return t}();__reflect(MMessage.prototype,"MMessage");var MessageKeys;!function(t){var e=1;t.MSG_BALANCE=""+e++,t.MSG_GAS_BALANCE=""+e++,t.MSG_LOGIN=""+e++,t.MSG_REGISTER=""+e++,t.MSG_ROOM_STATE=""+e++,t.MSG_NEW_ADDRESS=""+e++,t.MSG_FILL_GAS=""+e++,t.MSG_ROOM_PV=""+e++,t.MSG_APPOVE_OK=""+e++,t.MSG_PEOPLE=""+e++,t.MSG_BET=""+e++,t.MSG_UPDATE_ALLOWANCE=""+e++,t.MSG_RANK_LIST=""+e++,t.MSG_RANK_MINE=""+e++,t.MSG_LOGS=""+e++,t.MSG_HISTORY=""+e++,t.EVENT_Approval="Approval",t.EVENT_Bet="Bet"}(MessageKeys||(MessageKeys={}));